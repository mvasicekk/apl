<div class="container-fluid" ng-controller="majetekbewController">
    <div class="page-header">
	<h4>výdej majetku
	</h4>
	<apl-help editable="isEditor" helpTextUpdater="./updateHelpText.php" el="hIArray['form_help']" showhelp="showHelp" showadmininfo="showhI"></apl-help>
    </div>
    <!--<div class="text-right" data-spy="affix" data-offset-top="5" style="z-index: 99999;">-->
	<button type="button" class="btn btn-warning" ng-model="showHelp" uib-btn-checkbox>
	    ?
	</button>
	<button title="admin info" type="button" class="btn btn-info" ng-model="showhI" uib-btn-checkbox ng-show="securityInfo.showArray['admininfo_btn']"  >
	    AI
	</button>
    <form ng-submit="submitForm()" name="dambewForm" ng-model-options="{ updateOn: 'blur'}">
	<div class="row">
	    <div class="form-group col-sm-2 form-group-sm">
		<label class="control-label" for="">InvNr:</label>
		<div id="ui-select-wrapper">
		<ui-select		    ng-model="majetek.selected" 
					    ng-model-options="{updateOn: 'default blur',debounce: { 'default': 500, 'blur': 0 }}"
					    ng-disabled="disabled" 
					    reset-search-input="false" 
					    theme="bootstrap"
					    close-on-select="true"
					    on-select="majetekSelectAction($item,$model)"
					    id="majinvnr"
					    autofocus="true"
					    ><ui-select-match enterfocus placeholder="vyhledani majetku">{{$select.selected.CISLO}} - {{$select.selected.POPIS}}</ui-select-match>
					    <ui-select-choices repeat="p in majetekArray track by $index"
							       refresh="refreshMajetek($select.search)"
							       refresh-delay="0">
						<div ng-bind-html="p.CISLO + ' ' + p.POPIS + ' ' + p.TEXT_2 + ' (' + p.POZNAMKA + ')'| highlight: $select.search"></div>
					    </ui-select-choices>
					</ui-select>
		</div>
		<apl-help editable="isEditor"   helpTextUpdater="./updateHelpText.php" el="hIArray['invnr']" showhelp="showHelp" showadmininfo="showhI"></apl-help>
	    </div>
	    <!--datum-->
	    <div class="form-group col-sm-2 form-group-sm">
		<label class="control-label" for="">Datum:</label>
		<input enterfocus ng-model="datum" style="width:8em;" ui-date="dateOptions" type="text" class="form-control" id="" placeholder="datum">
		<apl-help  editable="isEditor"  helpTextUpdater="./updateHelpText.php" el="hIArray['datum']" showhelp="showHelp" showadmininfo="showhI"></apl-help>
	    </div>
	    
	    
	    <div class="form-group col-sm-2 form-group-sm">
		<label class="control-label" for="persnr">PersNr:</label>
		<input ng-change="persnrChanged()"  enterfocus maxlength="5" ng-model="persnr" type="text" class="form-control" id="persnr" placeholder="PersNr">
		    <span>{{persinfo.vorname}} {{persinfo.name}}</span>
		    <apl-help  editable="isEditor" helpTextUpdater="./updateHelpText.php"  el="hIArray['persnr']" showhelp="showHelp" showadmininfo="showhI"></apl-help>
	    </div>
	    
	    <div class="form-group col-sm-2 form-group-sm">
		    <label class="control-label" for="">OE:</label>
		    <select id="oe" enterfocus ng-change="" ng-options="option.tat+' - '+option.tatBezeichnung for option in oeArray track by option.tat" 
			    class="form-control" 
			ng-model="oe">
		    </select>
		    <apl-help  editable="isEditor"  helpTextUpdater="./updateHelpText.php" el="hIArray['oe']" showhelp="showHelp" showadmininfo="showhI"></apl-help>
	    </div>
	    
	    <div class="form-group col-sm-2 form-group-sm">
		<label class="control-label" for="">Ausgabe:</label>
		<input enterfocus maxlength="8" ng-model="ausgabe" type="text" class="form-control text-right" id="ausgabe" placeholder="ausgabe">
		<apl-help editable="isEditor"   helpTextUpdater="./updateHelpText.php" el="hIArray['ausgabe']" showhelp="showHelp" showadmininfo="showhI"></apl-help>
	    </div>
	    
	    <div class="form-group col-sm-2 form-group-sm">
		<label class="control-label" for="">Ruckgabe:</label>
		<input enterfocus maxlength="8" ng-model="ruckgabe" type="text" class="form-control text-right" id="ruckgabe" placeholder="ruckgabe">
		<apl-help editable="isEditor"   helpTextUpdater="./updateHelpText.php" el="hIArray['ruckgabe']" showhelp="showHelp" showadmininfo="showhI"></apl-help>
	    </div>
	    </div>
	    <div class="row">
	    <div class="form-group col-sm-4 form-group-sm">
		<label class="control-label" for="">Bemerkung:</label>
		<input enterfocus maxlength="255" ng-model="bemerkung" type="text" class="form-control" id="bemerkung" placeholder="bemerkung">
		<apl-help editable="isEditor"   helpTextUpdater="./updateHelpText.php" el="hIArray['bemerkung']" showhelp="showHelp" showadmininfo="showhI"></apl-help>
	    </div>
	    
	    <div class="form-group col-sm-2 form-group-sm valign_bottom">
		<button ng-disabled="!isFormValid()" type="submit" class="btn btn-primary" >erfassen / vložit</button>
		<apl-help editable="isEditor"   helpTextUpdater="./updateHelpText.php" el="hIArray['erfassen']" showhelp="showHelp" showadmininfo="showhI"></apl-help>
	    </div>
	    </div>
	<div ng-if="insertedRows.length>0" class="row">
	    <div class="col-sm-12">
		<table class="table table-condensed table-responsive table-striped">
		    <thead>
			<tr>
			    <th>invnr</th>
			    <th>datum</th>
			    <th>persnr</th>
			    <th>oe</th>
			    <th>ausgabe stk</th>
			    <th>rueckgabe stk</th>
			    <th>bemerkung</th>
			</tr>
		    </thead>
		    <tbody>
			<tr ng-repeat="r in insertedRows">
			    <td>
				{{r.m.CISLO}}
			    </td>
			    <td>
				{{r.datum}}
			    </td>
			    <td>
				{{r.persnr}}
			    </td>
			    <td>
				{{r.oe}}
			    </td>
			    <td>
				{{r.ausgabe}}
			    </td>
			    <td>
				{{r.ruckgabe}}
			    </td>
			    <td>
				{{r.bemerkung}}
			    </td>
			</tr>
		    </tbody>
		</table>
	    </div>
	</div>
    </form>
</div>

<!-- Modal pro pripad, ze nedostavam zadne vysledky pro majetek -->
<div class="modal fade" id="nomajetek_modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">žádný majetek k vydání</h4>
      </div>
      <div class="modal-body">
	  <div class="row">
	      <div class="col-sm-6">
		  <img src="../pers/img/wtf.jpg" alt="co to ?" class="img-rounded img-responsive">
	      </div>
	      <div class="col-sm-6">
		  <div class="alert alert-warning">
		      žádný majetek k vydání
		  </div>
		  <div ng-show="!userRoles.length>0" class="alert alert-warning">
		      uživatel nemá žádné role
		  </div>
		  <div ng-show="u==''" class="alert alert-warning">
		      uživatel není přihlášený
		  </div>
		  <div class="alert alert-info">
		      uzivatel: {{u}}
		  </div>
		  <div class="alert alert-info">
		       role:<i>({{userRolesStrStr}})</i>
		  </div>
	      </div>
	  </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">zavřít</button>
      </div>
    </div>
  </div>
</div>